#PGUSER=...
#PGPASSWORD=...
#PGHOST=...
#PGPORT=...
#PGDATABASE=...
#PGSSLMODE=...
#OPENAI_API_KEY= ...
#SLACK_BOT_TOKEN= ...

PGCONNECT_TIMEOUT=20
PGOPTIONS=-c tcp_keepalives_idle=30 -c tcp_keepalives_interval=10 -c tcp_keepalives_count=6 -c statement_timeout=0 -c idle_in_transaction_session_timeout=0

# chunking
# --- Chunking (revised for quality) ---
CHUNK_WINDOW=3             # from 2 → 3 → bigger average chunks (≈ 300–500 chars)
CHUNK_STRIDE=1             # keep stride=1 → overlap helps recall
CHUNK_MIN_CHARS=80         # from 40 → 80 → filter out super short bullets
CHUNK_MAX_TOKENS=800       # from 600 → 800 → allow denser chunks before split

# crawling
FOLLOW_LINKS=1
MAX_DEPTH=3
MAX_LINKS=100
FETCH_DELAY_MS=150
HTTP_TIMEOUT=10

# Health docs crawling
HEALTH_ROOT_URL=https://docs.digit.org/health
HEALTH_ALLOWED_HOST=docs.digit.org
HEALTH_OUT_DIR=data/gitbook_pages
HEALTH_MAX_PAGES=800
HEALTH_MAX_DEPTH=4
HEALTH_FETCH_DELAY_S=0.2
HEALTH_HTTP_TIMEOUT=10

# --- Embeddings & retrieval ---
EMBEDDING_MODEL=text-embedding-3-small          # or text-embedding-3-large (cost/quality tradeoff)
EMBED_DIM=1536                                  # must match the model and your pgvector schema
EMBED_NORMALIZE=1                               # store unit-normalized vectors (safer for cosine)
DISTANCE_METRIC=cosine                          # your pgvector index should use cosine if you normalize

# Hybrid search weighting (if your hybrid_retrieve_pg uses it)
HYBRID_ALPHA=0.35                               # 0=pure BM25, 1=pure vector; 0.3–0.5 is a good start
BM25_K1=1.2
BM25_B=0.75

# Optional re-ranker (helps MRR/precision@k)
RERANK_ENABLED=1
RERANK_TOPK=50                                  # re-rank top-N from the hybrid stage
RERANK_FINAL_K=10                               # how many to keep after re-ranking
RERANK_MODEL=cohere/rerank-3                    # or "openai/text-embedding-3-large+cosine" if using cross-encoder alt

# --- Crawler resilience ---
HTTP_MAX_RETRIES=3
HTTP_BACKOFF_S=0.25
USER_AGENT=RAG-Ingest/1.0 (+https://docs.digit.org)  # polite UA; some servers rate-limit without it

# --- Ingestion runtime ---
INGEST_CONCURRENCY=4
UPSERT_BATCH=128

# --- Tagging (helps evaluation/debug) ---
DOC_PRODUCT=HCM
DOC_SOURCE=health_docs


#ingest.py
CFG_TARGET_TOKENS = 1000
CFG_OVERLAP_TOKENS = 200
# Filter and safety rails
CFG_MIN_CHARS = 400
CFG_MAX_CHARS = 10000
# Atomic “action” lines (turned OFF by default; they polluted recall)
CFG_ENABLE_ATOMICS = false








